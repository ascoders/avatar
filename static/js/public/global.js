"use strict";function notice(e,t){require(["jquery","jquery.jbox"],function(){new jBox("Notice",{content:e,attributes:{x:"right",y:"bottom"},animation:"flip",color:t})})}function confirm(e,t){require(["jquery","jquery.jbox"],function(){var o=new jBox("Confirm",{minWidth:"200px",content:e,animation:"flip",confirmButton:"确定",cancelButton:"取消",confirm:function(){t()}});o.open()})}function userImage(e){return void 0!=e&&""!=e?isNaN(e)?e:"/static/img/user/"+e+".jpg":void 0}function post(e,t,o,n,a,r){require(["jquery","jquery.cookie"],function(i){var c=i.cookie("_xsrf");if(c){var l=c.split("|"),s=Base64.decode(l[0]),u={_xsrf:s};return u=i.extend(u,t),i.ajax({url:e,type:"POST",traditional:!0,data:u}).done(function(e){e.ok?(null!==o&&notice(o,"green"),null!=a&&a(e.data)):(null!==n&&notice(n+e.data,"red"),null!=r&&r(e.data))})}})}function createPagin(e,t,o,n){if(0==o)return"";var a=Math.ceil(parseFloat(o)/parseFloat(t));if(1==a)return"";var r=1;e=parseInt(e),t=parseInt(t),0!=e&&(r=e/t+1);var i="",c="";for(var l in n)c+="&"+l+"="+n[l];var s=window.location.pathname+"?number="+t+c,u=function(e){return(e-1)*t};if(i+=1==r?"<li><a class='disabled f-bln' href='#'><i class='fa fa-arrow-left'></i></a></li>":"<li><a class='f-bln' href='#!"+s+"&from="+(e-t)+"'><i class='fa fa-arrow-left'></i></a></li>",7>a)for(var f=1;a>=f;f++)i+=f==r?"<li><a class='active' href='#'>"+f+"</a></li>":"<li><a href='#!"+s+"&from="+u(f)+"'>"+f+"</a></li>";else if(6>r){for(var f=1;6>=f;f++)i+=f==r?"<li><a class='active' href='#'>"+f+"</a></li>":"<li><a href='#!"+s+"&from="+u(f)+"'>"+f+"</a></li>";i+="<li><a class='disabled' href='#'>...</a></li>",i+="<li><a href='#!"+s+"&from="+u(a)+"'>"+a+"</a></li>"}else if(i+="<li><a href='#!"+s+"&from="+u(1)+"'>1</a></li>",i+="<li><a href='#!"+s+"&from="+u(2)+"'>2</a></li>",i+="<li><a class='disabled' href='#'>...</a></li>",6>a-r)for(var f=a-6;a>=f;f++)i+=f==r?"<li><a class='active' href='#'>"+f+"</a></li>":"<li><a href='#!"+s+"&from="+u(f)+"'>"+f+"</a></li>";else{for(var f=r-2;r+3>=f;f++)i+=f==r?"<li><a class='active' href='#'>"+f+"</a></li>":"<li><a href='#!"+s+"&from="+u(f)+"'>"+f+"</a></li>";i+="<li><a class='disabled' href='#'>...</a></li>",i+="<li><a href='#!"+s+"&from="+u(a-1)+"'>"+(a-1)+"</a></li>",i+="<li><a href='#!"+s+"&from="+u(a)+"'>"+a+"</a></li>"}return i+=r==a?"<li><a class='disabled f-brn' href='javascript:void(0);'><i class='fa fa-arrow-right'></i></a></li>":"<li><a class='f-brn' href='#!"+s+"&from="+(e+t)+"'><i class='fa fa-arrow-right'></i></a></li>","<ul class='g-pa f-pr'>"+i+"</ul>"}function subStr(e,t,o){for(var n=0,a=0;t>a;a++)n+=escape(e.charCodeAt(a)).indexOf("%u")>=0?2:1;for(var r=n,a=t;o>a;a++)r+=escape(e.charCodeAt(a)).indexOf("%u")>=0?2:1;var i=e.substr(n,r);return i}function createDropzone(e,t,o,n,a){require(["jquery","dropzone","md5","jquery.jbox"],function(r,i,c){var l={};return new i(e,{url:t,maxFiles:10,maxFilesize:.5,method:"post",acceptedFiles:n,autoProcessQueue:!1,init:function(){this.on("addedfile",function(e){l[c(e.name)]=new jBox("Notice",{attributes:{x:"left",y:"bottom"},title:"上传 "+e.name+" 中..",theme:"NoticeBorder",color:"black",animation:{open:"slide:bottom",close:"slide:left"},autoClose:!1,closeOnClick:!1,onCloseComplete:function(){this.destroy()}});var t=this;post("/api/qiniu/createUpToken",o,null,"",function(e){t.options.params.token=e,t.processQueue()},function(){l[c(e.name)].close()})}),this.on("thumbnail",function(e,t){l[c(e.name)]&&l[c(e.name)].setContent('<img src="'+t+'"><br><div class="progress" style="margin:10px 0 0 0"><div class="progress-bar" id="upload'+c(e.name)+'" style="min-width:5%;">0%</div></div><br>尺寸: '+e.width+" × "+e.height+" &nbsp;&nbsp;大小: "+(e.size/1e3).toFixed(1)+" Kb<br>")}),this.on("error",function(e,t){notice(t.toString(),"red"),l[c(e.name)]&&(l[c(e.name)].close(),l[c(e.name)]=null)}),this.on("uploadprogress",function(e,t){l[c(e.name)]&&(t=t.toFixed(2),100==t&&(t=99),r("#upload"+c(e.name)).css("width",t+"%").text(t+"%"))}),this.on("success",function(e,t){notice("上传成功","green"),l[c(e.name)]&&(r("#upload"+c(e.name)).css("width","100%").text("100%"),setTimeout(function(){l[c(e.name)]&&(l[c(e.name)].close(),l[c(e.name)]=null)},200),a(t,e))})}})})}function timediff(e,t,o){function n(){var t=0,n=0,a=0,i=0;r.second>0?(t=Math.floor(r.second/86400),n=Math.floor(r.second/3600)-24*t,a=Math.floor(r.second/60)-24*t*60-60*n,i=Math.floor(r.second)-24*t*60*60-60*n*60-60*a):0==r.second&&o(),9>=a&&(a="0"+a),9>=i&&(i="0"+i),e.find("#j-day").html(t+" 天"),e.find("#j-hour").html(n+" 时"),e.find("#j-minute").html(a+" 分"),e.find("#j-second").html(i+" 秒"),r.second--}var a={second:0},r=$.extend(a,t);r.second=parseInt(r.second);var i=setInterval(function(){$.contains(document,e[0])||clearInterval(i),n()},1e3);n()}function jbox(){require(["jquery","jquery.jbox"],function(e){e(".jbox").each(function(){var t=e(this).attr("title");t&&(e(this).removeAttr("title"),e(this).jBox("Tooltip",{content:t,animation:"zoomIn",closeOnMouseleave:!0}))})})}avalon.config({interpolate:["{[{","}]}"]}),avalon.filters.cleanmark=function(e){return e=e.replace(/[!.*](.*)/g,"【图片】").replace(/\*/g,"").replace(/\`/g,"").replace(/\[/g,"").replace(/\]/g,"").replace(/\#/g,"").replace(/\-/g,"").replace(/\>/g,"")},require.config({paths:{jquery:"http://cdn.bootcss.com/jquery/1.11.2/jquery.min","jquery.timeago":"http://cdn.bootcss.com/jquery-timeago/1.4.0/jquery.timeago.min","jquery.ui":"http://cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min","jquery.autosize":"http://cdn.bootcss.com/autosize.js/1.18.15/jquery.autosize.min","jquery.selection":"http://cdn.bootcss.com/jquery.selection/1.0.1/jquery.selection.min","jquery.qrcode":"http://cdn.bootcss.com/jquery.qrcode/1.0/jquery.qrcode.min","jquery.cookie":"http://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie","jquery.autocomplete":"http://cdn.bootcss.com/jquery.devbridge-autocomplete/1.2.7/jquery.devbridge-autocomplete.min",dropzone:"http://cdn.bootcss.com/dropzone/3.12.0/dropzone-amd-module.min",prettify:"http://cdn.bootcss.com/prettify/r298/prettify.min",chart:"http://cdn.bootcss.com/Chart.js/1.0.1-beta.2/Chart.min",md5:"http://cdn.bootcss.com/blueimp-md5/1.1.0/js/md5.min","jquery.tree":"jquery.treeview","jquery.typetype":"jquery.typetype","jquery.taboverride":"taboverride",contextMenu:"jquery.contextMenu","jquery.jbox":"jBox",marked:"marked",editor:"editor",frontia:"baidu.frontia.1.0.0"},shim:{"jquery.timeago":{deps:["jquery"]},"jquery.ui":{deps:["jquery"]},"jquery.jbox":{deps:["jquery"]},"jquery.autosize":{deps:["jquery"]},"jquery.taboverride":{deps:["jquery"]},"jquery.selection":{deps:["jquery"]},"jquery.qrcode":{deps:["jquery"]},"jquery.typetype":{deps:["jquery"]},md5:{exports:"md5"},frontia:{exports:"baidu.frontia"},contextMenu:{deps:["jquery"]}}}),require(["jquery","jquery.timeago"],function(e){e.timeago.settings.allowFuture=!0,e.timeago.settings.localeTitle=!0,e.timeago.settings.strings={prefixAgo:null,prefixFromNow:null,suffixAgo:"前",suffixFromNow:"后",inPast:"现在",seconds:"<1分钟",minute:"1分钟",minutes:"%d 分钟",hour:"1小时",hours:"%d 小时",day:"一天",days:"%d 天",month:"一个月",months:"%d 个月",year:"一年",years:"%d 年",wordSeparator:" ",numbers:[]}}),require(["jquery"],function(e){e(".m-nav").on("mouseenter mouseleave",".j-drop",function(t){switch(t.type){case"mouseenter":e(this).find(".j-drop-content").show();break;case"mouseleave":e(this).find(".j-drop-content").hide()}}),e(".m-nav").on("mouseenter mouseleave",".j-right-drop",function(t){switch(t.type){case"mouseenter":e(this).find(".j-right-drop-content").show();break;case"mouseleave":e(this).find(".j-right-drop-content").hide()}})});var global=avalon.define({$id:"global",my:{},myLogin:!1,avalon:{},temp:{myDeferred:null,state:"",users:{},userHotCold:{}},github:function(){post("/api/check/setState",null,null,"",function(e){window.location.href="https://github.com/login/oauth/authorize?client_id=c6d10825049147370ff2&redirect_uri=http://www.avalon.org.cn/oauth&state="+e})},emptyObject:function(e){require(["jquery"],function(t){return t.isEmptyObject(e)})},getMessage:function(){console.log("get message")},signout:function(){post("/api/check/signout",null,"已退出",null,function(){global.myLogin=!1,global.my={},global.temp.state.stateName.indexOf("user")>-1&&avalon.router.navigate("/")})},$skipArray:["emptyObject","temp"]});require(["jquery","mmState"],function(e){global.temp.myDeferred=e.Deferred(),post("/api/check/currentUser",null,null,null,function(e){e.image=userImage(e.image),global.my=e,global.myLogin=!0,global.temp.myDeferred.resolve()},function(){global.temp.myDeferred.resolve()}),e.ajax({url:"https://api.github.com/repos/RubyLouvre/avalon",type:"GET",dataType:"jsonp"}).done(function(e){global.avalon=e.data}),avalon.router.error(function(){avalon.router.navigate("/404")}),avalon.state.config({onload:function(){global.temp.state=this},onloadError:function(){avalon.router.navigate("/404")}}),avalon.state("404",{controller:"global",url:"/404",views:{container:{templateUrl:"/static/html/public/404.html"}}}),avalon.state("index",{controller:"global",url:"/",views:{container:{templateUrl:"/static/html/index/home.html"}},onChange:function(){var e=this,t=this.async();require(["../index/index.js"],function(o){o.onChange(e),t()})},onAfterLoad:function(){require(["../index/index.js"],function(e){e.onAfterLoad(),avalon.scan()})}}),avalon.state("article",{controller:"global",url:"/art/{id}",views:{container:{templateUrl:"/static/html/article/article.html"}},onChange:function(){var e=this,t=this.async();require(["../article/article"],function(o){o.onChange(e),t()})},onAfterLoad:function(){require(["../article/article"],function(e){e.onAfterLoad()})}}),avalon.state("oauth",{controller:"global",url:"/oauth",views:{container:{templateUrl:"/static/html/check/oauth.html"}},onChange:function(){var e=this,t=this.async();require(["../check/oauth"],function(o){o.onChange(e,t),t()})},onAfterLoad:function(){require(["../check/oauth"],function(e){e.onAfterLoad()})}}),avalon.state("oauth",{controller:"global",url:"/oauth/jump",onChange:function(){location.href="https://openapi.baidu.com/social/oauth/2.0/receiver"+location.search}}),avalon.state("doc",{controller:"global",url:"/doc",views:{container:{templateUrl:"/static/html/doc/doc.html"}},"abstract":!0,onChange:function(){var e=this,t=this.async();require(["../doc/doc"],function(o){o.onChange(e),t()})},onAfterLoad:function(){require(["../doc/doc"],function(e){e.onAfterLoad()})}}),avalon.state("doc.page",{controller:"doc",url:"/{category}/{page}",views:{docContainer:{templateUrl:function(e){return"/static/html/doc/"+e.category+"/"+e.page+".html"}}},onChange:function(){var e=this,t=this.async();require(["../doc/"+this.params.category+"/"+this.params.page],function(o){o.onChange(e),t()})},onAfterLoad:function(e){require(["../doc/"+e.params.category+"/"+e.params.page],function(e){e.onAfterLoad()})}}),avalon.history.start({basepath:"/",html5Mode:!0,hashPrefix:"!"}),avalon.scan()});